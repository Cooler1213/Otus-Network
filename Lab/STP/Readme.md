### **Развертывание коммутируемой сети с резервными каналами.**
### **Принцип работы протокола STP**
##### Топология:
![Topolog](https://github.com/Cooler1213/Otus-Network/blob/e637821fc411fcf33bafe0ded539f1efd47f1972/Lab/STP/Topolog.png)
##### Задача:
1. Создание сети и настройка основных параметров устройств.
2. Выбор корневого коммутатора
3. Наблюдение за процессом выбора протоколом STP порта, исходя из стоимости портов
4. Наблюдение за процессом выбора протоколом STP порта, исходя из приоритета портов

Таблица адресации.

![Tab](https://github.com/Cooler1213/Otus-Network/blob/92f2f776696c8c1a564fcc438d47240e14cc0cb5/Lab/STP/Tab.png)

#### Часть 1. Создание сети и настройка основных параметров устройства.  

Настраиваем базовые параметры, прописываем адреса VLAN1 согласно таблице.  
Проверка связи командой ping:
1. S1 -> S2  OK
2. S1 -> S3  OK
3. S2 -> S3  OK

#### Часть 2. Выбор корневого коммутатора.  

1. Выключаем все порты.
###### int ran fa0/1-24 
###### shutdown
2. Настраиваем скомутированные порты в качестве транковых.
###### int ran fa 0/1-4 
###### switchport mode trunk
3. Включаем везде порты F0/2 и F0/4
###### int ran fa0/2,fa0/4
###### no shutdown
4. Просмотр данных протокола spanning-tree на всех комутаторах.
###### show spanning-tree 
![STP10](https://github.com/Cooler1213/Otus-Network/blob/5e3e648cab211395a68cc59d188866e77ea4674d/Lab/STP/STP10.png)
![STP11](https://github.com/Cooler1213/Otus-Network/blob/5e3e648cab211395a68cc59d188866e77ea4674d/Lab/STP/STP11.png)
![STP12](https://github.com/Cooler1213/Otus-Network/blob/5e3e648cab211395a68cc59d188866e77ea4674d/Lab/STP/STP12.png)

- Коммутатор с самым низким значением MAC-адреса становится корневым (в примере — S1)
- Корневые порты,ведут к корневому коммутатору  S3 F0/4 , S2 F0/2
- Назначеные порты ведут от корневого коммутатора S1 F0/4, S1 F0/2 , S3 F0/2
- Альтернативный порт (заблокирован) S2 F0/4
- На коммутаторах S2 и S3 стоимость портов одинакова (на данный момент и равна 19). Если стоимости портов равны, процесс сравнивает Port ID.  
Port ID привязан к порту и состоит из приоритета порта (0 – 240 с шагом 16, по умолчанию 128) и номера порта (чем ниже номер, тем выше приоритет).  
 S3 Fa0/2  = Prio.Nbr 128.2  
 S2 Fa0/4  = Prio.Nbr 128.4  
Заблокирован порт у которого Port ID больше S2 F0/4

![Root](https://github.com/Cooler1213/Otus-Network/blob/2e3b6adb3f49744c652806fd7d0db8a94fc0c593/Lab/STP/Root.png)

#### Часть 3. Наблюдение за процессом выбора протоколом STP порта, исходя из стоимости портов.
В этой части мы попробуем изменим стоимость порта.  
На предыдущем шаге выяснили,что spnning-tree блокирует S2 F0/4.  
Изменим стоимость порта S2 F0/2 до 18.  

###### interface f0/2  
###### spanning-tree cost 18  

Стало видно, что порт S2 F0/4 стал назначенным , а порт S3 F0/2 стал заблокированным.  
Удаляем введеные изменения.  

###### interface f0/2  
###### no spanning-tree  

Протокол spanning-tree заблокировал порт S3 F0/2 т.к. стоимость пути до S1 и стала предпочтительнее через S2.

#### Часть 4. Наблюдение за процессом выбора протоколом STP порта, исходя из приоритета портов.  

Включаем порты F0/1 и F0/3.  
Порт с меньшим номером порта S2 F0/1 теперь стал корневым, предыдущий порт S2 f0/2 стал заблокированным.  
Аналогично на S3 F0/3 стал корневым.  
Протокол STP выбрал эти порты в качестве портов корневого моста т.к. стоимость данных портов меньше, а следовательно путь   через них приоритетнее.

![Topolog](https://github.com/Cooler1213/Otus-Network/blob/812707634b75cb29699521d7197c5292a9a24565/Lab/STP/STP13.png)

[Конфиг для Packet Tracer.](https://github.com/Cooler1213/Otus-Network/blob/b767672f9ccb21483f3c16d48d7e67f64936b33b/Lab/STP/STP.pkt)
